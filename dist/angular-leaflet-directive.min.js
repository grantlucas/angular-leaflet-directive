/**!
 * The MIT License
 *
 * Copyright (c) 2013 the angular-leaflet-directive Team, http://tombatossals.github.io/angular-leaflet-directive
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 *
 * angular-google-maps
 * https://github.com/tombatossals/angular-leaflet-directive
 *
 * @authors https://github.com/tombatossals/angular-leaflet-directive/graphs/contributors
 */

/*! angular-leaflet-directive 16-11-2013 */
!function(){"use strict";angular.module("leaflet-directive",[]).directive("leaflet",["$log","$q","leafletData","leafletMapDefaults","leafletHelpers","leafletEvents",function(a,b,c,d,e,f){return{restrict:"EA",replace:!0,transclude:!0,scope:{center:"=center",defaults:"=defaults",maxBounds:"=maxbounds",bounds:"=bounds",marker:"=marker",markers:"=markers",legend:"=legend",geojson:"=geojson",paths:"=paths",tiles:"=tiles",layers:"=layers",controls:"=controls",eventBroadcast:"=eventBroadcast"},template:'<div class="angular-leaflet-map" ng-transclude></div>',controller:["$scope",function(a){a.leafletMap=b.defer(),this.getMap=function(){return a.leafletMap.promise},this.getLeafletScope=function(){return a}}],link:function(b,g,h){var i=e.isDefined,j=d.setDefaults(b.defaults,h.id),k=f.genDispatchMapEvent,l=f.getAvailableMapEvents();i(b.maxBounds)&&(j.minZoom=void 0),i(h.width)&&(isNaN(h.width)?g.css("width",h.width):g.css("width",h.width+"px")),i(h.height)&&(isNaN(h.height)?g.css("height",h.height):g.css("height",h.height+"px")),i(h.marker)&&a.warn("[AngularJS - Leaflet] The 'marker' property is currently deprecated, please use the 'markers' property instead.");var m=new L.Map(g[0],{maxZoom:j.maxZoom,minZoom:j.minZoom,keyboard:j.keyboard,dragging:j.dragging,zoomControl:j.zoomControl,doubleClickZoom:j.doubleClickZoom,scrollWheelZoom:j.scrollWheelZoom,attributionControl:j.attributionControl});if(b.leafletMap.resolve(m),c.setMap(m,h.id),i(h.center)||(a.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),m.setView([j.center.lat,j.center.lng],j.center.zoom)),!i(h.tiles)&&!i(h.layers)){var n=L.tileLayer(j.tileLayer,j.tileLayerOptions);n.addTo(m),c.setTiles(n)}if(i(m.zoomControl)&&i(j.zoomControlPosition)&&m.zoomControl.setPosition(j.zoomControlPosition),!i(h.eventBroadcast))for(var o="broadcast",p=0;p<l.length;p++){var q=l[p];m.on(q,k(b,q,o),{eventName:q})}}}}]),angular.module("leaflet-directive").directive("center",["$log","$parse","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(e,f,g,h){var i=d.isDefined,j=(d.isNumber,d.safeApply),k=d.isValidCenter,l=h.getLeafletScope(),m=l.center;h.getMap().then(function(d){c.getDefaults(g.id).then(function(c){if(i(m)){m.autoDiscover===!0&&d.locate({setView:!0,maxZoom:c.maxZoom});var e={lat:b("center.lat"),lng:b("center.lng"),zoom:b("center.zoom")}}else a.warn("[AngularJS - Leaflet] 'center' is undefined in the current scope, did you forget to initialize it?"),d.setView([c.center.lat,c.center.lng],c.center.zoom);var f=!1;l.$watch("center",function(b){return k(b)?(f||d.setView([b.lat,b.lng],b.zoom),void 0):(a.warn("[AngularJS - Leaflet] invalid 'center'"),d.setView([c.center.lat,c.center.lng],c.center.zoom),void 0)},!0),d.on("movestart",function(){f=!0}),d.on("moveend",function(){f=!1,j(l,function(a){e&&(e.lat.assign(a,d.getCenter().lat),e.lng.assign(a,d.getCenter().lng),e.zoom.assign(a,d.getZoom())),a.$emit("centerUpdated")})})})})}}}]),angular.module("leaflet-directive").directive("tiles",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(e,f,g,h){var i=(d.isDefined,h.getLeafletScope()),j=i.tiles;h.getMap().then(function(d){c.getDefaults(g.id).then(function(c){var e,f=c.tileLayer,h=c.tileLayerOptions;angular.isDefined(j)&&angular.isDefined(j.url)?(f=j.url,i.$watch("tiles.url",function(a){angular.isDefined(a)&&e.setUrl(a)})):a.warn("[AngularJS - Leaflet] The 'tiles' definition doesn't have the 'url' property."),angular.isDefined(j)&&angular.isDefined(j.options)&&angular.copy(j.options,h),e=L.tileLayer(f,h),e.addTo(d),b.setTiles(e,g.id)})})}}}]),angular.module("leaflet-directive").directive("legend",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,d,e,f){var g=b.isArray,h=f.getLeafletScope(),i=h.legend;f.getMap().then(function(b){if(g(i.colors)&&g(i.labels)&&i.colors.length===i.labels.length){var c=i.legendClass?i.legendClass:"legend",d=i.position||"bottomright",e=L.control({position:d});e.onAdd=function(){for(var a=L.DomUtil.create("div",c),b=0;b<i.colors.length;b++)a.innerHTML+='<div><i style="background:'+i.colors[b]+'"></i>'+i.labels[b]+"</div>";return a},e.addTo(b)}else a.warn("[AngularJS - Leaflet] legend.colors and legend.labels must be set.")})}}}]),angular.module("leaflet-directive").directive("geojson",["$log","$rootScope","leafletData","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,e,f,g){var h=d.safeApply,i=d.isDefined,j=g.getLeafletScope(),k={};g.getMap().then(function(a){j.$watch("geojson",function(d){if(i(d)&&(i(k)&&a.removeLayer(k),i(d.data))){var e=d.resetStyleOnMouseout,f=function(a,c){c.on({mouseover:function(c){h(j,function(){d.selected=a,b.$broadcast("leafletDirectiveMap.geojsonMouseover",c)})},mouseout:function(a){e&&k.resetStyle(a.target),h(j,function(){d.selected=void 0,b.$broadcast("leafletDirectiveMap.geojsonMouseout",a)})},click:function(a){h(j,function(){b.$broadcast("leafletDirectiveMap.geojsonClick",d.selected,a)})}})};i(d.options)?i(d.options.onEachFeature)||(d.options.onEachFeature=f):d.options={style:d.style,onEachFeature:f},k=L.geoJson(d.data,d.options),c.setGeoJSON(k),k.addTo(a)}})})}}}]),angular.module("leaflet-directive").directive("layers",["$log","$q","leafletData","leafletHelpers","leafletMapDefaults",function(a,b,c,d,e){var f;return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",controller:["$scope",function(){f=b.defer(),this.getLayers=function(){return f.promise}}],link:function(b,g,h,i){var j=d,k=d.isDefined,l=d.isString,m={},n=i.getLeafletScope(),o=n.layers;i.getMap().then(function(b){e.getDefaults(h.id).then(function(d){function e(b){if(!l(b.type))return a.error("[AngularJS - Leaflet] A base layer must have a type"),null;if("xyz"!==b.type&&"wms"!==b.type&&"group"!==b.type&&"markercluster"!==b.type&&"google"!==b.type&&"bing"!==b.type)return a.error('[AngularJS - Leaflet] A layer must have a valid type: "xyz, wms, group, google"'),null;if(("xyz"===b.type||"wms"===b.type)&&!l(b.url))return a.error("[AngularJS - Leaflet] A base layer must have an url"),null;if(!l(b.name))return a.error("[AngularJS - Leaflet] A base layer must have a name"),null;(void 0===b.layerParams||null===b.layerParams||"object"!=typeof b.layerParams)&&(b.layerParams={}),(void 0===b.layerOptions||null===b.layerOptions||"object"!=typeof b.layerOptions)&&(b.layerOptions={});var c=null;for(var d in b.layerParams)b.layerOptions[d]=b.layerParams[d];switch(b.type){case"xyz":c=g(b.url,b.layerOptions);break;case"wms":c=i(b.url,b.layerOptions);break;case"group":c=p();break;case"markercluster":c=q(b.layerOptions);break;case"google":c=r(b.layerType,b.layerOptions);break;case"bing":c=s(b.bingKey,b.layerOptions);break;default:c=null}return c}function g(a,b){var c=L.tileLayer(a,b);return c}function i(a,b){var c=L.tileLayer.wms(a,b);return c}function p(){var a=L.layerGroup();return a}function q(a){if(j.MarkerClusterPlugin.isLoaded()){var b=new L.MarkerClusterGroup(a);return b}return null}function r(a,b){if(a=a||"SATELLITE",j.GoogleLayerPlugin.isLoaded()){var c=new L.Google(a,b);return c}return null}function s(a,b){if(j.BingLayerPlugin.isLoaded()){var c=new L.BingLayer(a,b);return c}return null}if(k(o)){if(!k(o.baselayers)||Object.keys(o.baselayers).length<=0)return a.error("[AngularJS - Leaflet] At least one baselayer has to be defined"),void 0;f.resolve(m),c.setLayers(m,h.id),m.baselayers={},m.controls={},m.controls.layers=new L.control.layers,m.controls.layers.setPosition(d.controlLayersPosition),m.controls.layers.addTo(b);var t=!1;for(var u in o.baselayers){var v=e(o.baselayers[u]);null!==v&&(m.baselayers[u]=v,o.baselayers[u].top===!0&&(b.addLayer(m.baselayers[u]),t=!0),m.controls.layers.addBaseLayer(m.baselayers[u],o.baselayers[u].name))}!t&&Object.keys(m.baselayers).length>0&&b.addLayer(m.baselayers[Object.keys(o.baselayers)[0]]),m.overlays={};for(u in o.overlays){var w=e(o.overlays[u]);null!==w&&(m.overlays[u]=w,o.overlays[u].visible===!0&&b.addLayer(m.overlays[u]),m.controls.layers.addOverlay(m.overlays[u],o.overlays[u].name))}n.$watch("layers.baselayers",function(c){for(var d in m.baselayers)void 0===c[d]&&(m.controls.layers.removeLayer(m.baselayers[d]),b.hasLayer(m.baselayers[d])&&b.removeLayer(m.baselayers[d]),delete m.baselayers[d]);for(var f in c)if(void 0===m.baselayers[f]){var g=e(c[f]);null!==g&&(m.baselayers[f]=g,c[f].top===!0&&b.addLayer(m.baselayers[f]),m.controls.layers.addBaseLayer(m.baselayers[f],c[f].name))}if(Object.keys(m.baselayers).length<=0)a.error("[AngularJS - Leaflet] At least one baselayer has to be defined");else{var h=!1;for(var i in m.baselayers)if(b.hasLayer(m.baselayers[i])){h=!0;break}h||b.addLayer(m.baselayers[Object.keys(o.baselayers)[0]])}},!0),n.$watch("layers.overlays",function(a){for(var c in m.overlays)void 0===a[c]&&(m.controls.layers.removeLayer(m.overlays[c]),b.hasLayer(m.overlays[c])&&b.removeLayer(m.overlays[c]),delete m.overlays[c]);for(var d in a)if(void 0===m.overlays[d]){var f=e(a[d]);null!==f&&(m.overlays[d]=f,m.controls.layers.addOverlay(m.overlays[d],a[d].name),a[d].visible===!0&&b.addLayer(m.overlays[d]))}},!0)}})})}}}]),angular.module("leaflet-directive").directive("bounds",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(c,d,e,f){var g=b.isDefined,h=(b.isNumber,f.getLeafletScope()),i=h.bounds;f.getMap().then(function(b){function c(a){return g(a)&&g(a.isValid)?a.isValid():void 0}h.$watch("bounds",function(d){if(!g(d)||!c(d))return a.error("[AngularJS - Leaflet] Invalid bounds"),void 0;var e=d.getSouthWest(),f=d.getNorthEast(),h=new L.LatLngBounds(new L.LatLng(e.lat,e.lng),new L.LatLng(f.lat,f.lng));b.getBounds().equals(h)||b.fitBounds(h)},!0),h.$watch("center",function(){if(i){var a=b.getBounds(),c=a.getSouthWest(),d=a.getNorthEast();i={southWest:{lat:c.lat,lng:c.lng},northEast:{lat:d.lat,lng:d.lng}}}})})}}}]),angular.module("leaflet-directive").directive("markers",["$log","$rootScope","$q","leafletData","leafletHelpers","leafletMapDefaults",function(a,b,c,d,e,f){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:["leaflet","?layers"],link:function(b,g,h,i){var j=i[0],k=e,l=e.isDefined,m=e.isDefinedAndNotNull,n=e.isString,o=e.isNumber,p=(e.safeApply,j.getLeafletScope()),q=p.markers;j.getMap().then(function(b){f.getDefaults(h.id).then(function(e){var f,g={},j={};f=l(i[1])?i[1].getLayers:function(){var a=c.defer();return a.resolve(),a.promise};var r=L.Icon.extend({options:{iconUrl:e.icon.url,iconRetinaUrl:e.icon.retinaUrl,iconSize:e.icon.size,iconAnchor:e.icon.anchor,labelAnchor:e.icon.labelAnchor,popupAnchor:e.icon.popup,shadowUrl:e.icon.shadow.url,shadowRetinaUrl:e.icon.shadow.retinaUrl,shadowSize:e.icon.shadow.size,shadowAnchor:e.icon.shadow.anchor}});l(q)&&f().then(function(c){function e(b,d,e){var g=f(d);if(l(d.layer)){if(!n(d.layer))return a.error("[AngularJS - Leaflet] A layername must be a string"),null;if(!m(c))return a.error("[AngularJS - Leaflet] You must add layers to the directive if used in a marker"),null;if(!m(c.overlays))return a.error("[AngularJS - Leaflet] You must add layers overlays to the directive if used in a marker"),null;if(!m(c.overlays[d.layer]))return a.error("[AngularJS - Leaflet] You must use a name of an existing layer"),null;var h=c.overlays[d.layer];if(!(h instanceof L.LayerGroup))return a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"'),null;h.addLayer(g),e.hasLayer(g)&&d.focus===!0&&g.openPopup()}else l(d.group)?(l(j[d.group])||(j[d.group]=L.markerClusterGroup(),e.addLayer(j[d.group])),j[d.group].addLayer(g)):e.addLayer(g),l(L.Label)&&l(d.label)&&l(d.label.options)&&d.label.options.noHide===!0&&g.showLabel(),d.focus===!0&&g.openPopup();g.on("dragend",function(a){this.marker_data.message&&this.marker_data.focus===!0&&a.target.openPopup()},{marker_data:d});var i=p.$watch(b,function(b,d){if(!m(b)){if(g.closePopup(),m(c)&&l(c.overlays))for(var f in c.overlays)c.overlays[f]instanceof L.LayerGroup&&c.overlays[f].hasLayer(g)&&c.overlays[f].removeLayer(g);return e.removeLayer(g),i(),void 0}if(l(d)){if(n(b.layer)){if(m(d.layer)||d.layer!==b.layer)if("string"==typeof d.layer&&void 0!==c.overlays[d.layer]&&c.overlays[d.layer].hasLayer(g)&&c.overlays[d.layer].removeLayer(g),g.closePopup(),e.hasLayer(g)&&e.removeLayer(g),void 0!==c.overlays[b.layer]){var h=c.overlays[b.layer];h instanceof L.LayerGroup?(h.addLayer(g),e.hasLayer(g)&&b.focus===!0&&g.openPopup()):a.error('[AngularJS - Leaflet] A marker can only be added to a layer of type "group"')}else a.error("[AngularJS - Leaflet] You must use a name of an existing layer")}else n(d.layer)&&(l(c.overlays[d.layer])&&c.overlays[d.layer].hasLayer(g)&&(c.overlays[d.layer].removeLayer(g),g.closePopup()),e.hasLayer(g)||e.addLayer(g));if(void 0===b.draggable||null===b.draggable||b.draggable!==!0?void 0!==d.draggable&&null!==d.draggable&&d.draggable===!0&&g.dragging&&g.dragging.disable():(void 0===d.draggable||null===d.draggable||d.draggable!==!0)&&(g.dragging?g.dragging.enable():L.Handler.MarkerDrag&&(g.dragging=new L.Handler.MarkerDrag(g),g.options.draggable=!0,g.dragging.enable())),void 0===b.icon||null===b.icon||"object"!=typeof b.icon)void 0!==d.icon&&null!==d.icon&&"object"==typeof d.icon&&(g.setIcon(new r),g.closePopup(),g.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&g.bindPopup(b.message));else if(void 0===d.icon||null===d.icon||"object"!=typeof d.icon){var j=!1;g.dragging&&(j=g.dragging.enabled()),k.AwesomeMarkersPlugin.is(b.icon)?g.setIcon(b.icon):k.Leaflet.DivIcon.is(b.icon)||k.Leaflet.Icon.is(b.icon)?g.setIcon(b.icon):g.setIcon(new r(b.icon)),j&&g.dragging.enable(),g.closePopup(),g.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&g.bindPopup(b.message)}else if(k.AwesomeMarkersPlugin.is(b.icon)){if(!k.AwesomeMarkersPlugin.equal(b.icon,d.icon)){var p=!1;g.dragging&&(p=g.dragging.enabled()),g.setIcon(b.icon),p&&g.dragging.enable(),g.closePopup(),g.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&g.bindPopup(b.message)}}else if(k.Leaflet.DivIcon.is(b.icon)){if(!k.Leaflet.DivIcon.equal(b.icon,d.icon)){var q=!1;g.dragging&&(q=g.dragging.enabled()),g.setIcon(b.icon),q&&g.dragging.enable(),g.closePopup(),g.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&g.bindPopup(b.message)}}else if(k.Leaflet.Icon.is(b.icon)){if(!k.Leaflet.Icon.equal(b.icon,d.icon)){var s=!1;g.dragging&&(s=g.dragging.enabled()),g.setIcon(b.icon),s&&g.dragging.enable(),g.closePopup(),g.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&g.bindPopup(b.message)}}else if(JSON.stringify(b.icon)!==JSON.stringify(d.icon)){var t=!1;g.dragging&&(t=g.dragging.enabled()),g.setIcon(new r(b.icon)),t&&g.dragging.enable(),g.closePopup(),g.unbindPopup(),void 0!==b.message&&null!==b.message&&"string"==typeof b.message&&""!==b.message&&g.bindPopup(b.message)}if(void 0===b.message||null===b.message||"string"!=typeof b.message||""===b.message?void 0!==d.message&&null!==d.message&&"string"==typeof d.message&&""!==d.message&&(g.closePopup(),g.unbindPopup()):void 0===d.message||null===d.message||"string"!=typeof d.message||""===d.message?(g.bindPopup(b.message),b.focus===!0&&g.openPopup()):b.message!==d.message&&g.setPopupContent(b.message),void 0===b.focus||null===b.focus||b.focus!==!0?void 0!==d.focus&&null!==d.focus&&d.focus===!0&&g.closePopup():void 0===d.focus||null===d.focus||d.focus!==!0?g.openPopup():d.focus===!0&&b.focus===!0&&g.openPopup(),o(b.lat)&&o(b.lng)){var u=g.getLatLng();if(u.lat!==b.lat||u.lng!==b.lng){var v=!1;n(b.layer)&&k.MarkerClusterPlugin.is(c.overlays[b.layer])&&(c.overlays[b.layer].removeLayer(g),v=!0),g.setLatLng([b.lat,b.lng]),v&&c.overlays[b.layer].addLayer(g)}}else{if(a.warn("There are problems with lat-lng data, please verify your marker model"),m(c)&&m(c.overlays))for(var w in c.overlays)(c.overlays[w]instanceof L.LayerGroup||k.MarkerClusterPlugin.is(c.overlays[w]))&&c.overlays[w].hasLayer(g)&&c.overlays[w].removeLayer(g);e.removeLayer(g)}}},!0);return g}function f(a){var b=null;b=a.icon?a.icon:new r;var c={icon:b,draggable:a.draggable?!0:!1,clickable:l(a.clickable)?a.clickable:!0};a.title&&(c.title=a.title);var d=new L.marker(a,c);return a.message&&d.bindPopup(a.message),l(L.Label)&&l(a.label)&&l(a.label.message)&&d.bindLabel(a.label.message,a.label.options),d}p.$watch("markers",function(a){for(var f in g)if(!l(a)||!l(a[f])){if(g[f].closePopup(),m(c)&&l(c.overlays))for(var i in c.overlays)c.overlays[i]instanceof L.LayerGroup&&c.overlays[i].hasLayer(g[f])&&c.overlays[i].removeLayer(g[f]);if(m(j))for(var k in j)j[k].hasLayer(g[f])&&j[k].removeLayer(g[f]);b.removeLayer(g[f]),delete g[f]}for(var n in a)if(!l(g[n])){var o=e("markers."+n,a[n],b);null!==o&&(g[n]=o)}d.setMarkers(g,h.id)},!0)})})})}}}]),angular.module("leaflet-directive").directive("paths",["$log","leafletData","leafletMapDefaults","leafletHelpers",function(a,b,c,d){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,e,f,g){var h=d.isDefined,i=g.getLeafletScope(),j=i.paths;g.getMap().then(function(d){c.getDefaults(f.id).then(function(c){function e(b,c,d,e){function f(a){if(h(a.latlngs))switch(a.type){default:case"polyline":case"polygon":j.setLatLngs(i(a.latlngs));break;case"multiPolyline":case"multiPolygon":j.setLatLngs(k(a.latlngs));break;case"rectangle":j.setBounds(new L.LatLngBounds(i(a.latlngs)));break;case"circle":case"circleMarker":j.setLatLng(g(a.latlngs)),h(a.radius)&&j.setRadius(a.radius)}h(a.weight)&&j.setStyle({weight:a.weight}),h(a.color)&&j.setStyle({color:a.color}),h(a.opacity)&&j.setStyle({opacity:a.opacity})}var j,l={weight:e.path.weight,color:e.path.color,opacity:e.path.opacity};switch(h(c.stroke)&&(l.stroke=c.stroke),h(c.fill)&&(l.fill=c.fill),h(c.fillColor)&&(l.fillColor=c.fillColor),h(c.fillOpacity)&&(l.fillOpacity=c.fillOpacity),h(c.smoothFactor)&&(l.smoothFactor=c.smoothFactor),h(c.noClip)&&(l.noClip=c.noClip),h(c.type)||(c.type="polyline"),c.type){default:case"polyline":j=new L.Polyline([],l);break;case"multiPolyline":j=new L.multiPolyline([[[0,0],[1,1]]],l);break;case"polygon":j=new L.Polygon([],l);break;case"multiPolygon":j=new L.MultiPolygon([[[0,0],[1,1],[0,1]]],l);break;case"rectangle":j=new L.Rectangle([[0,0],[1,1]],l);break;case"circle":j=new L.Circle([0,0],1,l);break;case"circleMarker":j=new L.CircleMarker([0,0],l)}d.addLayer(j);var m=a.$watch("paths."+b,function(a){return h(a)?(f(a),void 0):(d.removeLayer(j),m(),void 0)},!0);return j}function g(a){return new L.LatLng(a.lat,a.lng)}function i(a){return a.filter(function(a){return!!a.lat&&!!a.lng}).map(function(a){return new L.LatLng(a.lat,a.lng)})}function k(a){return a.map(function(a){return i(a)})}var l={};b.setPaths(l,f.id),h(j)&&a.$watch("paths",function(a){for(var b in a)h(l[b])||(l[b]=e(b,a[b],d,c));for(var f in l)h(a[f])||delete l[f]},!0)})})}}}]),angular.module("leaflet-directive").directive("controls",["$log","leafletHelpers",function(a,b){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(a,c,d,e){var f=b.isDefined,g=e.getLeafletScope(),h=g.controls;e.getMap().then(function(a){if(f(L.Control.Draw)&&f(h.draw)){var b=new L.Control.Draw(h.draw.options);a.addControl(b)}})}}}]),angular.module("leaflet-directive").directive("eventBroadcast",["$log","$rootScope","leafletData","leafletHelpers","leafletEvents",function(a,b,c,d,e){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,f,g,h){var i=(d.safeApply,d.isDefinedAndNotNull,d.isDefined,d.isObject),j=h.getLeafletScope(),k=j.eventBroadcast,l=e.getAvailableMapEvents(),m=e.genDispatchMapEvent,n=e.getAvailableMarkerEvents(),o=e.genDispatchMarkerEvent;h.getMap().then(function(b){var c,d,e=[],f="broadcast";if(i(k)){if(void 0===k.map||null===k.map)e=l;else if("object"!=typeof k.map)a.warn("[AngularJS - Leaflet] event-broadcast.map must be an object check your model.");else{void 0!==k.map.logic&&null!==k.map.logic&&("emit"!==k.map.logic&&"broadcast"!==k.map.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===k.map.logic&&(f="emit"));var g=!1,h=!1;if(void 0!==k.map.enable&&null!==k.map.enable&&"object"==typeof k.map.enable&&(g=!0),void 0!==k.map.disable&&null!==k.map.disable&&"object"==typeof k.map.disable&&(h=!0),g&&h)a.warn("[AngularJS - Leaflet] can not enable and disable events at the time");else if(g||h)if(g)for(c=0;c<k.map.enable.length;c++)d=k.map.enable[c],-1!==e.indexOf(d)?a.warn("[AngularJS - Leaflet] This event "+d+" is already enabled"):-1===l.indexOf(d)?a.warn("[AngularJS - Leaflet] This event "+d+" does not exist"):e.push(d);else for(e=l,c=0;c<k.map.disable.length;c++){d=k.map.disable[c];var n=e.indexOf(d);-1===n?a.warn("[AngularJS - Leaflet] This event "+d+" does not exist or has been already disabled"):e.splice(n,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}for(c=0;c<e.length;c++)d=e[c],b.on(d,m(j,d,f),{eventName:d})}else a.warn("[AngularJS - Leaflet] event-broadcast must be an object, check your model.")}),c.getMarkers().then(function(b){var c,d,e=[],f="broadcast";if(i(k))if(void 0===k.marker||null===k.marker)e=n;else if("object"!=typeof k.marker)a.warn("[AngularJS - Leaflet] event-broadcast.marker must be an object check your model.");else{void 0!==k.marker.logic&&null!==k.marker.logic&&("emit"!==k.marker.logic&&"broadcast"!==k.marker.logic?a.warn("[AngularJS - Leaflet] Available event propagation logic are: 'emit' or 'broadcast'."):"emit"===k.marker.logic&&(f="emit"));var g=!1,h=!1;if(void 0!==k.marker.enable&&null!==k.marker.enable&&"object"==typeof k.marker.enable&&(g=!0),void 0!==k.marker.disable&&null!==k.marker.disable&&"object"==typeof k.marker.disable&&(h=!0),g&&h)a.warn("[AngularJS - Leaflet] can not enable and disable events at the same time");else if(g||h)if(g)for(c=0;c<k.marker.enable.length;c++)d=k.marker.enable[c],-1!==e.indexOf(d)?a.warn("[AngularJS - Leaflet] This event "+d+" is already enabled"):-1===n.indexOf(d)?a.warn("[AngularJS - Leaflet] This event "+d+" does not exist"):e.push(d);else for(e=n,c=0;c<k.marker.disable.length;c++){d=k.marker.disable[c];var l=e.indexOf(d);-1===l?a.warn("[AngularJS - Leaflet] This event "+d+" does not exist or has been already disabled"):e.splice(l,1)}else a.warn("[AngularJS - Leaflet] must enable or disable events")}for(var m in b)for(c=0;c<e.length;c++)d=e[c],b[m].on(d,o(j,d,f,m),{eventName:d,key:m})})}}}]),angular.module("leaflet-directive").directive("maxbounds",["$log","leafletMapDefaults","leafletHelpers",function(a,b,c){return{restrict:"A",scope:!1,replace:!1,transclude:!1,require:"leaflet",link:function(b,d,e,f){var g=c.isDefined,h=c.isNumber,i=f.getLeafletScope(),j=i.maxBounds;f.getMap().then(function(b){g(j)&&g(j.southWest)&&g(j.northEast)?i.$watch("maxBounds",function(a){g(a.southWest)&&g(a.northEast)&&h(a.southWest.lat)&&h(a.southWest.lng)&&h(a.northEast.lat)&&h(a.northEast.lng)&&b.setMaxBounds(new L.LatLngBounds(new L.LatLng(a.southWest.lat,a.southWest.lng),new L.LatLng(a.northEast.lat,a.northEast.lng)))}):a.warn("[AngularJS - Leaflet] 'maxBounds' is defined in the current scope, but not correctly initialized.")})}}}]),angular.module("leaflet-directive").service("leafletData",["$log","$q","leafletHelpers",function(a,b,c){var d=(c.isDefined,c.getDefer),e={main:b.defer()},f={main:b.defer()},g={main:b.defer()},h={main:b.defer()},i={main:b.defer()},j={main:b.defer()};this.setMap=function(a,b){var c=d(e,b);c.resolve(a)},this.getMap=function(a){var b=d(e,a);return b.promise},this.getPaths=function(a){var b=d(h,a);return b.promise},this.setPaths=function(a,b){var c=d(h,b);c.resolve(a)},this.getMarkers=function(a){var b=d(i,a);return b.promise},this.setMarkers=function(a,b){var c=d(i,b);c.resolve(a)},this.getLayers=function(a){var b=d(g,a);return b.promise},this.setLayers=function(a,b){var c=d(g,b);c.resolve(a)},this.setTiles=function(a,b){var c=d(f,b);c.resolve(a)},this.getTiles=function(a){var b=d(f,a);return b.promise},this.setGeoJSON=function(a,b){var c=d(j,b);c.resolve(a)},this.getGeoJSON=function(a){var b=d(j,a);return b.promise}}]),angular.module("leaflet-directive").factory("leafletMapDefaults",["$q","leafletHelpers",function(a,b){function c(){return{maxZoom:18,minZoom:1,keyboard:!0,dragging:!0,doubleClickZoom:!0,scrollWheelZoom:!0,zoomControl:!0,attributionControl:!0,zoomsliderControl:!1,zoomControlPosition:"topleft",controlLayersPosition:"topright",tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",tileLayerOptions:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'},icon:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-icon-2x.png",size:[25,41],anchor:[12,40],labelAnchor:[10,-20],popup:[0,-40],shadow:{url:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",retinaUrl:"http://cdn.leafletjs.com/leaflet-0.6.4/images/marker-shadow.png",size:[41,41],anchor:[12,40]}},path:{weight:10,opacity:1,color:"#0000ff"},center:{lat:0,lng:0,zoom:1}}}var d=b.isDefined,e=b.getDefer,f={main:a.defer()};return{getDefaults:function(a){var b=e(f,a);return b.promise},setDefaults:function(a,b){var g=e(f,b),h=c();return d(a)&&(h.maxZoom=d(a.maxZoom)?parseInt(a.maxZoom,10):h.maxZoom,h.minZoom=d(a.minZoom)?parseInt(a.minZoom,10):h.minZoom,h.doubleClickZoom=d(a.doubleClickZoom)?a.doubleClickZoom:h.doubleClickZoom,h.scrollWheelZoom=d(a.scrollWheelZoom)?a.scrollWheelZoom:h.doubleClickZoom,h.zoomControl=d(a.zoomControl)?a.zoomControl:h.zoomControl,h.attributionControl=d(a.attributionControl)?a.attributionControl:h.attributionControl,h.tileLayer=d(a.tileLayer)?a.tileLayer:h.tileLayer,h.zoomControlPosition=d(a.zoomControlPosition)?a.zoomControlPosition:h.zoomControlPosition,h.keyboard=d(a.keyboard)?a.keyboard:h.keyboard,h.dragging=d(a.dragging)?a.dragging:h.dragging,h.controlLayersPosition=d(a.controlLayersPosition)?a.controlLayersPosition:h.controlLayersPosition,d(a.tileLayerOptions)&&angular.copy(a.tileLayerOptions,h.tileLayerOptions)),g.resolve(h),h}}}]),angular.module("leaflet-directive").factory("leafletEvents",["$rootScope","$q","leafletHelpers",function(a,b,c){var d=c.safeApply;return{getAvailableMapEvents:function(){return["click","dblclick","mousedown","mouseup","mouseover","mouseout","mousemove","contextmenu","focus","blur","preclick","load","unload","viewreset","movestart","move","moveend","dragstart","drag","dragend","zoomstart","zoomend","zoomlevelschange","resize","autopanstart","layeradd","layerremove","baselayerchange","overlayadd","overlayremove","locationfound","locationerror","popupopen","popupclose"]},genDispatchMapEvent:function(b,c,e){return function(f){var g="leafletDirectiveMap."+c;d(b,function(b){"emit"===e?b.$emit(g,{leafletEvent:f}):"broadcast"===e&&a.$broadcast(g,{leafletEvent:f})})}},getAvailableMarkerEvents:function(){return["click","dblclick","mousedown","mouseover","mouseout","contextmenu","dragstart","drag","dragend","move","remove","popupopen","popupclose"]},genDispatchMarkerEvent:function(b,c,e,f){return function(g){var h="leafletDirectiveMarker."+c;d(b,function(b){"emit"===e?b.$emit(h,{leafletEvent:g,markerName:f}):"broadcast"===e&&a.$broadcast(h,{leafletEvent:g,markerName:f})})}}}}]),angular.module("leaflet-directive").factory("leafletHelpers",["$q",function(a){return{isDefined:function(a){return angular.isDefined(a)},isNumber:function(a){return angular.isNumber(a)},isDefinedAndNotNull:function(a){return angular.isDefined(a)&&null!==a},isString:function(a){return angular.isString(a)},isArray:function(a){return angular.isArray(a)},isObject:function(a){return angular.isObject(a)},equals:function(a,b){return angular.equals(a,b)},isValidCenter:function(a){return angular.isDefined(a)&&angular.isNumber(a.lat)&&angular.isNumber(a.lng)&&angular.isNumber(a.zoom)},safeApply:function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?a.$eval(b):a.$apply(b)},getDefer:function(b,c){angular.isDefined(c)||(c="main");var d;return angular.isDefined(b[c])?d=b[c]:(d=a.defer(),b[c]=d),d},AwesomeMarkersPlugin:{isLoaded:function(){return void 0!==L.AwesomeMarkers?void 0!==L.AwesomeMarkers.Icon:!1},is:function(a){return this.isLoaded()?a instanceof L.AwesomeMarkers.Icon:!1},equal:function(a,b){return this.isLoaded?this.is(a)&&this.is(b)?a.options.icon===b.options.icon&&a.options.iconColor===b.options.iconColor&&a.options.color===b.options.color&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]&&a.options.popupAnchor[0]===b.options.popupAnchor[0]&&a.options.popupAnchor[1]===b.options.popupAnchor[1]&&a.options.shadowAnchor[0]===b.options.shadowAnchor[0]&&a.options.shadowAnchor[1]===b.options.shadowAnchor[1]&&a.options.shadowSize[0]===b.options.shadowSize[0]&&a.options.shadowSize[1]===b.options.shadowSize[1]:!1:!1}},MarkerClusterPlugin:{isLoaded:function(){return void 0!==L.MarkerClusterGroup},is:function(a){return this.isLoaded()?a instanceof L.MarkerClusterGroup:!1}},GoogleLayerPlugin:{isLoaded:function(){return void 0!==L.Google},is:function(a){return this.isLoaded()?a instanceof L.Google:!1}},BingLayerPlugin:{isLoaded:function(){return void 0!==L.BingLayer},is:function(a){return this.isLoaded()?a instanceof L.BingLayer:!1}},Leaflet:{DivIcon:{is:function(a){return a instanceof L.DivIcon},equal:function(a,b){return this.is(a)&&this.is(b)?a.options.html===b.options.html&&a.options.iconSize[0]===b.options.iconSize[0]&&a.options.iconSize[1]===b.options.iconSize[1]&&a.options.iconAnchor[0]===b.options.iconAnchor[0]&&a.options.iconAnchor[1]===b.options.iconAnchor[1]:!1}},Icon:{is:function(a){return a instanceof L.Icon},equal:function(a,b){return this.is(a)?angular.equals(a,b):!1}}}}}])}();